<tool id="influx_s" name="influx_si" version="0.3.0" python_template_version="3.5">
    <description>metabolic flux analysis</description>

    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements"/>
    <!--
#silent sys.stderr.write("!!!! Cheetah Template Variables !!!!\n")
#for k,v in $searchList[2].items()
#silent   sys.stderr.write(" %s = %s\n" % (str(k), str(v) ))
#end for
    -->
    <command detect_errors="exit_code"><![CDATA[
       #set $inp_all = [$input_main, ($input_aux if $input_aux else [])]
       #if $si.s_i == 'i':
         #silent $inp_all.append($input_ti)
       #end if
       #for $inp in $inp_all:
         #for $i in $inp:
           mv '$i' '$i.name';
         #end for
       #end for
       
       influx_$si.s_i '${"' '".join([str($in_m.name) for $in_m in $input_main])}';
       
       mkdir outdir;
       
       #for $inp in $inp_all:
         #for $i in $inp:
           n="$i.name"; for f in *"\${n/.ftbl/}"*; do ([ -e "\$f" ] && mv "\$f" outdir/) || [ true ] ; done;
         #end for
       #end for
       
       ([ -e parallel.R ] && mv parallel.R outdir/) || [ true ];
       
    ]]></command>
    <expand macro="inputs" />
    <outputs>
       <collection name="influx_si_output" type="list" label="influx_si result">
              <discover_datasets pattern="(?P&lt;name&gt;.*)" directory="outdir" visible="false"/>
       </collection>
       <!--data name="output1" format="zip" /-->
    </outputs>
    <tests>
       <test>
              <param name="input_main" value="e_coli.ftbl"/>
              <conditional name="si">
                     <param name="s_i" value="s"/>
              </conditional>
              <output_collection name="influx_si_output" type="list">
                <element name="e_coli.log" file="e_coli.log" compare="sim_size" delta="100"/>
              </output_collection>
       </test>
       <test>
              <param name="input_main" value="e_coli.ftbl,e_coli_growth.ftbl"/>
              <conditional name="si">
                     <param name="s_i" value="s"/>
              </conditional>
              <output_collection name="influx_si_output" type="list">
                <element name="e_coli_growth.log" file="e_coli_growth.log" compare="sim_size" delta="100"/>
              </output_collection>
       </test>
       <test>
              <param name="input_main" value="e_coli_i.ftbl"/>
              <conditional name="si">
                     <param name="s_i" value="i"/>
                     <param name="input_ti" value="e_coli_msen.txt"/>
              </conditional>
              <output_collection name="influx_si_output" type="list">
                <element name="e_coli_i.log" file="e_coli_i.log" compare="sim_size" delta="100"/>
              </output_collection>
       </test>
       <test>
              <param name="input_main" value="e_coli_1-Glc_exact.ftbl"/>
              <param name="input_aux" value="e_coli_U-Glc_exact.ftbl"/>
              <conditional name="si">
                     <param name="s_i" value="s"/>
              </conditional>
              <output_collection name="influx_si_output" type="list">
                <element name="e_coli_1-Glc_exact.log" file="e_coli_1-Glc_exact.log" compare="sim_size" delta="100"/>
              </output_collection>
       </test>
    </tests>
    <expand macro="help" />
    <expand macro="citation" />
</tool>
